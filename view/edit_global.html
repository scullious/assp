<script>
    var r_type = "<?=$meter->getVars()['r_type'];?>";
    var r_id = "<?=$meter->getVars()['r_id'];?>";
</script>

<br/>
<h3 style='text-align: center; color: #444;'>Списки районов и объектов</h3>
<div style="display: flex; justify-content: space-around;">
    <button type='button' class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px; margin-left: 15%;" data-toggle="modal" data-target="#modalRegions" id="btn_mod_addReg">Районы</button>
    <button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px;" data-toggle="modal" data-target="#modalStructures" id="btn_mod_addStr">Объектов<br/>снабжения</button>
    <button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px; margin-right: 15%;" data-toggle="modal" data-target="#modalTuses" id="btn_mod_addTus">ТУСы и офисы</button>
    <!--button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px;" data-toggle="modal" data-target="#modalOwners" id="btn_mod_addOwn">Объекты<br/>балансовой<br/>принадлежности</button-->
</div>
<h3 style='text-align: center; color: #444;'>Информация по приборам учета</h3>
<div style="display: flex; justify-content: space-around;">
    <button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px;" data-toggle="modal" data-target="#modalMeterTypes" id="btn_mod_addMeterType">Типы счетчиков<br/></button>
    <button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px;" data-toggle="modal" data-target="#modalMeterNums" id="btn_mod_addMeterNum">Номера счетчиков</button>
    <button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px;" data-toggle="modal" data-target="#modalMeters" id="btn_mod_addMeter">Общая<br/>информация</button>
    <button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px;" data-toggle="modal" data-target="#modalMeterDates" id="btn_mod_addMeterDate">Даты и сроки<br/></button>
</div>
<h3 style='text-align: center; color: #444;'>Информация по договорам</h3>
<div style="display: flex; justify-content: space-between;">
    <button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px; margin-left: 32%;" data-toggle="modal" data-target="#modalAgrs" id="btn_mod_addAgr">Договоры</button>
    <button type="button" class="btn btn-dark" style="height: 120px; width: 200px; margin: 50px; margin-right: 32%;" data-toggle="modal" data-target="#modalAgrRels" id="btn_mod_addAgrRel">Связка<br/>договор-счетчик</button>
</div>


<!-- REGIONS -->
<div id='modalRegions' class='modal' style='background-color: rgba(100,100,100,0.3)'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 400px">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='text-align: center; font-size: 1.7rem;'>Районы</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 35%;">&times;</span>
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='reg_table'>
                    <thead>
                        <th class="align-middle">Район</th>
                        <th class="align-middle" style='width: 10%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->regs as $r) { ?>
                            <tr>
                                <td class='align-middle' style='height: 40px'><?=$r['name'];?></td>
                                <td class='align-middle' style='height: 40px'></td>
                            </tr>
                        <?php } ?>
                        <tr>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='new_reg' /></td>
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('reg')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- STRUCTURES -->
<div id='modalStructures' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='font-size: 1.3rem; text-align: center; line-height: 1.3;'>Объекты снабжения</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 21%;">&times;</span>
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='str_table'>
                    <thead>
                        <th class="align-middle">Наименование объекта</th>
                        <th class="align-middle" style='width: 10%'></th>
                    </thead>
                    <tbody>
                    <?php foreach ($meter->str_types as $s) { ?>
                        <tr>
                            <td class='align-middle' style='height: 40px'><?=$s['type'];?></td>
                            <td class='align-middle' style='height: 40px'></td>
                        </tr>
                    <?php } ?>
                        <tr>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='new_str' /></td>
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('str')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- TUSes -->
<div id='modalTuses' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 350px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='font-size: 1.3rem; text-align: center; line-height: 1.3;'>ТУСы и офисы</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 26%;">&times;</span>
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='tus_table'>
                    <thead>
                        <th class="align-middle">ТУС/офис</th>
                        <th class="align-middle" style='width: 10%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->tuses as $t) { ?>
                            <tr>
                                <td class='align-middle' style='height: 40px'><?=$t['name'];?></td>
                                <td class='align-middle' style='height: 40px'></td>
                            </tr>
                        <?php } ?>
                        <tr>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='new_tus' /></td>
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('tus')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- OWNERS -->
<div id='modalOwners' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='font-size: 1.3rem; text-align: center; line-height: 1.3;'>Объекты балансовой принадлежности</h2>
                <span class='close' style="padding: 0px; padding-right: 3px;">&times;</span>
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='own_table'>
                    <thead>
                        <th class="align-middle">Собственник</th>
                        <th class="align-middle" style='width: 10%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->owners as $o) { ?>
                            <tr>
                                <td class='align-middle' style='height: 40px'><?=$o['name'];?></td>
                                <td class='align-middle' style='height: 40px'></td>
                            </tr>
                        <?php } ?>
                        <tr>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='new_own' /></td>
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('own')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- METER TYPES -->
<div id='modalMeterTypes' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 300px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='font-size: 1.5rem; text-align: center; line-height: 1.3;'>Типы счетчиков</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 14%;">&times;</span>
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='meterType_table'>
                    <thead>
                        <th hidden class="align-middle">id</th>
                        <th class="align-middle">Тип счетчика</th>
                        <th class="align-middle" style='width: 10%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->meter_types as $mt) { ?>
                            <tr>
                                <td hidden class='align-middle' style='height: 40px'><?=$mt['mt_id'];?></td>
                                <td class='align-middle' style='height: 40px'><?=$mt['type'];?></td>
                                <td class='align-middle' style='height: 40px'></td>
                            </tr>
                        <?php } ?>
                        <tr>
                            <td hidden></td>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='meterTypes_meter_type' /></td>
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('meter_type')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- METER NUMS -->
<div id='modalMeterNums' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 400px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='font-size: 1.3rem; text-align: center; line-height: 1.3;'>Заводские номера счетчиков</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 9%;">&times;</span>
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='meterNum_table'>
                    <thead>
                        <th hidden class="align-middle">id</th>
                        <th class="align-middle">Номер счетчика</th>
                        <th class="align-middle" style='width: 40%'>Тип ресурса</th>
                        <th class="align-middle" style='width: 10%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->meter_nums as $mn) { ?>
                            <tr>
                                <td hidden class='align-middle'><?=$mn['id'];?></td>
                                <td class='align-middle'><?=$mn['meter_num'];?></td>
                                <td class='align-middle'><?=$mn['res_name'];?></td>
                                <td class='align-middle'>
                                    <button type="button" onclick="del_data('meter_num', $(this))" class="btn btn-light" style="background-color: white;">
                                        <img src="img/del.png" width="30px" />
                                    </button>
                                </td>
                            </tr>
                        <?php } ?>
                        <tr>
                            <td hidden></td>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='meterNums_meter_num' /></td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='meterNums_res_name'>
                                    <?php   
                                        foreach ($meter->res_names as $rn) { ?>
                                            <option value='<?=$rn['res_id'];?>'><?=$rn['name'];?></option>
                                    <?php } ?>
                                </select>
                            </td>
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('meter_num')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- METERS' GENERAL INFO -->
<div id='modalMeters' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 1600px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='text-align: center; font-size: 1.8rem;'>Информация о счетчиках</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 38.5%;">&times;</span>
            </div>
            <div class='finder' style='display: flex; padding: 0.01rem 0.5rem;'>
                <input type='search' placeholder='поиск по № счетчика' class='form-control' style='width: 13.6%' id='find_meters_meterNum' />
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='meterInfo_table'>
                    <thead>
                        <th class="align-middle" style='width: 11%'>Заводской номер</th>
                        <th hidden class="align-middle" style="width: 8%">ID</th>
                        <th class="align-middle" style='width: 7%'>Тип счетчика</th>
                        <th class="align-middle" style='width: 11%'>Район</th>
                        <th class="align-middle" style='width: 6%'>ТУС</th>
                        <th class="align-middle" style='width: 15%'>Объект</th>
                        <th class="align-middle" style="width: 5%">Номер<br/>объекта</th>
                        <th class="align-middle" style="width: 15%">Адрес</th>
                        <th class="align-middle" style="width: 5%">Тип<br/>ресурса</th>
                        <!--th class="align-middle" style="width: 10%">Балансовая принадлежность</th-->
                        <th class="align-middle" style='width: 1%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->meter_info as $m) { ?>
                        <tr>
                            <td class='align-middle'><?=$m['meter_num'];?></td>
                            <td hidden class='align-middle'><?=$m['id'];?></td>
                            <td class='align-middle'><?=$m['meter_type'];?></td>
                            <td class='align-middle'><?=$m['reg'];?></td>
                            <td class='align-middle'><?=$m['tus'];?></td>
                            <td class='align-middle'><?=$m['str_type'];?></td>
                            <td class='align-middle'><?=$m['str_num'];?></td>
                            <td class='align-middle'><?=$m['address'];?></td>
                            <td class='align-middle'><?=$m['res_name'];?></td>
                            <!--td class='align-middle'><?//=$m['owner'];?></td-->
                            <td class='align-middle'>
                                <button type="button" onclick="del_data('meter_info', $(this))" class="btn btn-light" style="background-color: white;">
                                    <img src="img/del.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                        <?php } ?>
                        <tr>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='meters_meter_num'>
                                    <?php   
                                        foreach ($meter->meter_nums as $mn) { ?>
                                            <option value='<?=$mn['meter_num'];?>'><?=$mn['meter_num'];?></option>
                                    <?php } ?>
                                </select>
                            </td>
                            <td hidden class='align-middle'><input class='form-control' style="text-align:right;" id='meters_id' /></td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='meters_meter_type'>
                                    <?php 
                                        if (!empty($meter->meter_types)) {
                                            foreach ($meter->meter_types as $mt) { ?>
                                            <option value='<?=$mt['mt_id'];?>'><?=$mt['type'];?></option>
                                    <?php   }
                                        } ?>
                                </select>
                            </td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='reg'>
                                    <?php   
                                        foreach ($meter->regs as $r) { ?>
                                            <option value='<?=$r['reg_id'];?>'><?=$r['name'];?></option>
                                    <?php } ?>
                                </select>
                            </td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='tus'>
                                    <?php   
                                        foreach ($meter->tuses as $t) { ?>
                                            <option value='<?=$t['tus_id'];?>'><?=$t['name'];?></option>
                                    <?php } ?>
                                </select>
                            </td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='str_type'>
                                    <?php   
                                        foreach ($meter->str_types as $s) { ?>
                                            <option value='<?=$s['st_id'];?>'><?=$s['type'];?></option>
                                    <?php } ?>
                                </select>
                            </td>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='str_num' /></td>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='address' /></td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='meters_res_name'>
                                    <?php 
                                        if (!empty($meter->res_names)) {
                                            foreach ($meter->res_names as $rn) { ?>
                                            <option value='<?=$rn['res_id'];?>'><?=$rn['name'];?></option>
                                    <?php   }
                                        } ?>
                                </select>
                            </td>
                            <!--td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='owner'>
                                    <?php   
                                        //foreach ($meter->owners as $o) { ?>
                                            <option value='<?//=$o['own_id'];?>'><?//=$o['name'];?></option>
                                    <?php //} ?>
                                </select>
                            </td-->
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('meter_info')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- METERS' DATE/VALIDATION INFO -->
<div id='modalMeterDates' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 750px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='text-align: center; font-size: 1.8rem;'>Информация о датах</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 29.5%;">&times;</span>
            </div>
            <div class='finder' style='display: flex; padding: 0.01rem 0.5rem;'>
                <input type='search' placeholder='поиск по № счетчика' class='form-control' style='width: 24.6%' id='find_meterDates_meterNum' />
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='meterDate_table'>
                    <thead>
                        <th class="align-middle" style="width: 25%;">Заводской номер</th>
                        <th class="align-middle" style="width: 156px;">Дата<br/>установки</th>
                        <th class="align-middle" style="width: 156px;">Дата ввода в<br/>эксплуатацию</th>
                        <th hidden class="align-middle" style="width: 156px;">Дата осмотра</th>
                        <th hidden class="align-middle" style="width: 156px;">Дата<br/>след. осмотра</th>
                        <th class="align-middle" style="width: 156px;">Поверка<br/>до</th>
                        <th hidden>res_name</th>
                        <th class="align-middle" style='width: 1%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->meter_info as $m) { ?>
                        <tr>
                            <td class='align-middle'><?=$m['meter_num'];?></td>
                            <td class='align-middle'><?=$m['setup_date'];?></td>
                            <td class='align-middle'><?=$m['comm_date'];?></td>
                            <td hidden class='align-middle'><?=$m['inspect_date'];?></td>
                            <td hidden class='align-middle'><?=$m['next_insp_date'];?></td>
                            <td class='align-middle'><?=$m['end_verif'];?></td>
                            <td hidden class='align-middle'><?=$m['res_name'];?></td>
                            <td class='align-middle'>
                                <button type="button" onclick="edit_data($(this))" class="btn btn-light" style="background-color: white;">
                                    <img src="img/edit.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                        <?php } ?>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- AGREEMENTS -->
<div id='modalAgrs' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 600px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='text-align: center; font-size: 1.7rem;'>Договоры</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 38%;">&times;</span>
            </div>
            <div class='finder' style='display: flex; padding: 0.01rem 0.5rem;'>
                <input type='search' placeholder='поиск по № договора' class='form-control' style='width: 31%' id='find_agrs_name' />
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' id='agr_table'>
                    <thead>
                        <th hidden>id</th>
                        <th class="align-middle" style='width: 31.7%'>Договор</th>
                        <th class="align-middle">Дата заключения</th>
                        <th class="align-middle">Тип ресурса</th>
                        <th class="align-middle" style='width: 10%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->agrs as $a) { ?>
                            <tr>
                                <td hidden class='align-middle'><?=$a['ag_id'];?></td>
                                <td class='align-middle'><?=$a['name'];?></td>
                                <td class='align-middle'><?=$a['conclusion_date'];?></td>
                                <td class='align-middle'><?=$a['res_name'];?></td>
                                <td class='align-middle'>
                                    <button type="button" onclick="del_data('agr', $(this))" class="btn btn-light" style="background-color: white;">
                                        <img src="img/del.png" width="30px" />
                                    </button>
                                </td>
                            </tr>
                        <?php } ?>
                        <tr>
                            <td hidden></td>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='new_agr' /></td>
                            <td class='align-middle'><input type="date" class='form-control' style="text-align:right;" id='concl_date' /></td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='agrs_res_name'>
                                    <?php 
                                        if (!empty($meter->res_names)) {
                                            foreach ($meter->res_names as $rn) { ?>
                                            <option value='<?=$rn['res_id'];?>'><?=$rn['name'];?></option>
                                    <?php   }
                                        } ?>
                                </select>
                            </td>
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('agr')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

<!-- RELATIONS AGR<->METER -->
<div id='modalAgrRels' class='modal' style='background-color: rgba(100,100,100,0.3);'>
    <div class="modal-dialog modal-dialog-centered" style="max-width: 600px;">
        <div class='modal-content'>
            <div class='modal-header' style='justify-content: flex-end;'>
                <h2 class="modal-title align-middle" style='text-align: center; font-size: 1.5rem; line-height: 1.3;'>Связка договор-счетчик</h2>
                <span class='close' style="padding: 0px; padding-right: 3px; margin-left: 25%;">&times;</span>
            </div>
            <div class='finder' style='display: flex; padding: 0.01rem 0.5rem;'>
                <input type='search' placeholder='поиск по № договора' class='form-control' style='width: 32.4%; margin-right: 111px;' id='find_agrRels_name' />
                <input type='search' placeholder='поиск по № счетчика' class='form-control' style='width: 33.9%' id='find_agrRels_meterNum' />
            </div>
            <div class='modal-body tableFixHead'>
                <table class='table rounded table-bordered text-center' style='max-height: 500px' id='rel_table'>
                    <thead>
                        <th hidden>uid</th>
                        <th class="align-middle" style='width: 30%'>Договор</th>
                        <th class="align-middle" style='width: 18%'>Код точки учета</th>
                        <th class="align-middle" style='width: 31%'>Заводской номер счетчика</th>
                        <th class="align-middle" style='width: 1%'></th>
                    </thead>
                    <tbody>
                        <?php foreach ($meter->general as $g) { ?>
                            <tr>
                                <td hidden class='align-middle'><?=$g['uid'];?></td>
                                <td class='align-middle'><?=$g['agr'];?></td>
                                <td class='align-middle'><?=$g['code'];?></td>
                                <td class='align-middle'><?=$g['meter_num'];?></td>
                                <td class='align-middle'>
                                    <button type="button" onclick="del_data('rel', $(this))" class="btn btn-light" style="background-color: white;">
                                        <img src="img/del.png" width="30px" />
                                    </button>
                                </td>
                            </tr>
                        <?php } ?>
                        <tr>
                            <td hidden></td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right; position: " id='agr'>
                                    <?php 
                                        foreach ($meter->agrs as $a) { ?>
                                            <option value='<?=$a['ag_id'];?>'><?=$a['name'];?></option>
                                    <?php } ?>
                                </select>
                            </td>
                            <td class='align-middle'><input class='form-control' style="text-align:right;" id='code' /></td>
                            <td class='align-middle'>
                                <select class='form-control' style="text-align:right;" id='agrRel_meter_num'>
                                    <?php 
                                        foreach ($meter->meter_nums as $mn) { ?>
                                            <option value='<?=$mn['id'];?>'><?=$mn['meter_num'];?></option>
                                    <?php } ?>
                                </select>
                            </td>
                            <td class='align-middle'>
                                <button type="button" onclick="new_data('rel')" class="btn btn-light" style="background-color: white;">
                                    <img src="img/add.png" width="30px" />
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-dark" data-dismiss="modal">Назад</button>
            </div>
        </div>
    </div>
</div>

